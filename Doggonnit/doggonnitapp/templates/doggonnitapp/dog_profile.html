<head>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.42.2/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.42.2/mapbox-gl.css' rel='stylesheet'/>
</head>


<style>
    .container img {
        width:150px;
        padding-bottom: 5px;
    }

    .container h3{
        color:lightseagreen;
        font-size: 24px;
    }

    .marker_div {
        display: block;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        padding: 0;
        background-image:{{MEDIA_URL}}{{ dog.dog_image }};
    }
</style>

<body>

    <div class="container">
        {% if dog.dog_is_lost  %}
            <h1>**MISSING**</h1>
        {% endif %}

        <h3> {{ dog.name.upper }} </h3>

        <img src="{{MEDIA_URL}}{{ dog.dog_image }}" />

        <div class="container">
            <div> Age : {{dog.age}} </div>
            <div> Gender : {{dog.sex}} </div>
            <div> Breed : {{dog.breed}} </div>
            <div> Color : {{dog.color}} </div>
            <div> Pattern : {{dog.pattern}} </div>
            <div> Weight : {{dog.weight}} lbs </div>
            <div> Personality : {{dog.personality}} </div>
            <div> Description : {{dog.description}} </div>
        </div>

        <form action="{% url 'doggonnitapp:dog_profile' dog.id %}" method="POST">
            {% csrf_token %}
            {% if dog.dog_is_lost  %}
                <button type="submit"> Report as found! </button>
                {% else %}
                    <button type="submit"> Report as missing </button>
            {% endif %}
        </form>
    </div>

    {% if dog.dog_is_lost %}
        <div id='map' style='width: 600px; height: 500px;'></div>

        <script>
            //home coordinates for dog
            let lat = {{ profile.latitude }};
            let lng = {{ profile.longitude }};

            //add new map
            mapboxgl.accessToken = '{{ mapbox_api_key }}';
            let map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/streets-v9',
                center: [lng, lat],
                zoom: 10
            });

            //add map features
            map.addControl(new mapboxgl.GeolocateControl({
                positionOptions: {
                    enableHighAccuracy: true
                    },
                    trackUserLocation: true
            }));

            map.addControl(new mapboxgl.FullscreenControl());

            let nav = new mapboxgl.NavigationControl();
            map.addControl(nav, 'top-left');

            //create new marker for missing dog's home
            function new_lost_marker(x, y){
                let marker = new mapboxgl.Marker()
                    .setLngLat([x, y])
                    .addTo(map);
            }

            let div = document.createElement('div');
            div.className = "marker_div";
            div.innerHTML = new_lost_marker(lng, lat)


        </script>

    {% endif %}

    <a href="{% url 'doggonnitapp:dogmap' %}">Go to map of all missing dogs</a>

    <script>
        map.on('click', function (e) {
            let lat = e.lngLat.lat;
            let lng = e.lngLat.lng;
            new_lost_marker(lng, lat)
        });
    </script>


</body>